# 账本功能禁用设计文档

## 概述
本文档描述了如何实现账本功能的禁用配置选项。当前系统中的账本功能是完全实现的，但默认总是启用的。通过添加一个配置选项，管理员可以控制账本功能是否可用。

## 架构设计

### 配置架构
1. 在 `Config` 类中添加新的配置属性 `EnableAccounting`，默认值为 `false`
2. 在 `Env` 静态类中添加对应的静态属性 `EnableAccounting`
3. 在配置加载过程中将配置文件中的值映射到 `Env.EnableAccounting`

### 控制器架构
1. 在 `AccountController` 中添加功能检查逻辑
2. 当功能禁用时，所有账本相关命令将被忽略并返回友好提示
3. 保持现有功能的完整性和隔离性

## 组件和接口

### 配置组件
- **Config.cs**: 在配置模型中添加 `EnableAccounting` 属性
- **Env.cs**: 添加静态属性并更新配置加载逻辑

### 控制器组件
- **AccountController.cs**: 添加功能检查逻辑和友好的禁用提示

## 数据模型
不需要新的数据模型。现有数据模型保持不变：
- `GroupAccountSettings.IsAccountingEnabled`：保持原有群组级别的控制
- `AccountBook` 和 `AccountRecord`：表结构不变

## 错误处理
1. 当账本功能被禁用时，返回友好的中文提示信息
2. 提示信息不暴露系统内部细节
3. 不会产生异常，只是忽略命令并给出提示

## 测试策略
1. 单元测试覆盖启用/禁用两种状态
2. 当功能禁用时，确认相关命令被正确忽略
3. 当功能启用时，确认所有现有功能正常工作
4. 性能测试确保禁用状态下无额外开销

## 设计决策说明

### 为什么选择在控制器层面检查？
- **最小侵入性**: 只需在入口点添加检查，不影响现有业务逻辑
- **性能优化**: 功能禁用时完全避免数据库访问
- **易于维护**: 集中控制，避免在多处添加检查逻辑

### 为什么默认值是禁用？
- **安全性**: 新功能默认禁用是更安全的选择
- **明确启用**: 管理员需要显式启用功能，确保知情同意
- **减少资源消耗**: 避免在不需要时加载相关组件