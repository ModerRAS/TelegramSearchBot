# TelegramSearchBot - 用户指令与使用说明

本文档旨在提供 TelegramSearchBot 的用户指令列表及其使用方法，帮助用户更好地与机器人进行交互。

## 一、通用用户指令

这些指令可由任何用户在与机器人私聊或在机器人所在的群组中使用。

1.  **搜索内容**
    *   **指令格式**: `搜索 <关键词>`
    *   **功能**: 在机器人索引的消息中搜索包含指定关键词的内容。
    *   **示例**: `搜索 Orleans入门教程`
    *   **说明**: 机器人会返回搜索结果，并可能提供分页按钮以便浏览更多结果。

2.  **解析链接 (手动)**
    *   **指令**: `/resolveurls`
    *   **功能**: 当用户明确使用此命令时，解析提供的文本（或回复的消息中的文本）中包含的短链接或重定向链接，并显示其最终的目标长链接。
    *   **用法1 (直接提供文本)**: `/resolveurls <包含一个或多个链接的文本>`
        *   **示例**: `/resolveurls 这是b23.tv/xxxx的一个短链接，还有t.cn/AAAA的另一个。`
    *   **用法2 (回复消息)**: 回复一条包含链接的消息，并发送指令 `/resolveurls`。
    *   **说明**: 机器人会回复解析后的链接列表。此命令主要用于即时查看链接的解析结果。链接的自动后台处理和存储是另一项功能（见下文“自动URL解析与存储”）。

## 二、管理员指令

这些指令通常需要特定的管理员权限才能执行。

### 1. LLM 模型设置 (普通管理员)

普通管理员通常指在被设置为“管理群”的群组内具有管理员权限的用户，或全局管理员。

*   **设置当前聊天使用的LLM模型**
    *   **指令格式**: `设置模型 <模型名称>`
    *   **功能**: 为当前聊天（群组或私聊）设置后续与LLM交互时使用的模型。
    *   **示例**: `设置模型 gpt-4-turbo`
    *   **权限**: 普通管理员或全局管理员。

### 2. 全局管理员指令

以下指令仅限机器人全局管理员（在 `Env.cs` 中配置的 `AdminId`）使用。

*   **设置/取消管理群**
    *   **指令**: `设置管理群`
        *   **功能**: 将当前群组设置为“管理群”。“管理群”内的管理员可能拥有执行某些特定指令的权限（如 `设置模型`）。
        *   **用法**: 在目标群组中发送 `设置管理群`。
    *   **指令**: `取消管理群`
        *   **功能**: 取消当前群组的“管理群”状态。
        *   **用法**: 在目标群组中发送 `取消管理群`。

*   **Bilibili 相关配置**
    *   **设置B站Cookie**
        *   **指令格式**: `/setbilicookie <Cookie字符串>` 或 `设置B站Cookie <Cookie字符串>`
        *   **功能**: 设置用于访问Bilibili受限内容（如会员视频信息）的Cookie。
        *   **示例**: `/setbilicookie SESSDATA=xxxxxx; bili_jct=yyyyy;`
    *   **获取B站Cookie状态**
        *   **指令**: `/getbilicookie` 或 `获取B站Cookie`
        *   **功能**: 检查当前是否已配置B站Cookie，并显示其长度（出于安全考虑，不显示完整值）。
    *   **设置B站视频最大下载大小**
        *   **指令格式**: `/setbilimaxsize <MB数>` 或 `设置B站最大下载大小 <MB数>`
        *   **功能**: 设置机器人尝试下载Bilibili视频时的文件大小上限（单位：MB）。
        *   **示例**: `/setbilimaxsize 500` (表示最大下载500MB的视频)
    *   **获取B站视频最大下载大小**
        *   **指令**: `/getbilimaxsize` 或 `获取B站最大下载大小`
        *   **功能**: 查看当前配置的Bilibili视频最大下载大小。

## 三、自动功能与内容触发器

机器人还具有一些基于消息内容或类型的自动处理功能：

1.  **与LLM对话 (需要配置并启用OpenAI/Ollama等服务)**
    *   **触发方式1 (提及机器人)**: 在消息中 `@机器人用户名 <你的消息>`。
        *   **示例**: `@MyAwesomeBot 帮我总结一下这篇文章的主要内容。`
    *   **触发方式2 (回复机器人消息)**: 直接回复机器人的某条消息。
    *   **功能**: 将您的消息发送给配置的LLM进行处理，并回复LLM的响应。

2.  **Bilibili链接处理**
    *   **触发方式**: 发送包含Bilibili视频链接、动态链接、番剧链接或短链接（如 `b23.tv`, `acg.tv`）的消息。
    *   **功能**: 机器人会自动识别链接，获取视频/动态的详细信息（标题、UP主、封面、简介等），并尝试发送视频文件（如果大小在限制内且可下载）或图片（对于动态）。如果发送媒体文件失败，则会发送文本摘要信息。

3.  **图片OCR识别 (需启用 `EnableAutoOCR`)**
    *   **触发方式1 (自动处理)**: 发送图片。
        *   **功能**: 机器人会自动对图片进行OCR识别，并将识别出的文本内容合并到消息中进行存储（主要用于后续搜索）。默认情况下不直接回复识别结果。
    *   **触发方式2 (显式打印)**: 发送图片，并在图片的“说明/Caption”中填写文字 `打印`。
        *   **功能**: 对图片进行OCR识别，并将识别出的文本直接回复给用户。

4.  **语音/视频ASR识别 (需启用 `EnableAutoASR`)**
    *   **触发方式**: 发送语音消息、音频文件或视频文件（需启用 `EnableVideoASR`）。
    *   **功能**: 机器人会自动对音频/视频进行ASR（语音转文字）处理，并将识别出的文本回复给用户。如果文本过长，可能会以 `.srt` 文件形式发送。识别的文本也会合并到消息中进行存储。

5.  **二维码识别与处理**
    *   **触发方式**: 发送包含二维码的图片。
    *   **功能**:
        1.  机器人会自动识别图片中的二维码。
        2.  如果识别成功，会将二维码的原始文本内容直接回复给用户。
        3.  同时，机器人会将二维码的文本内容作为一条新的文本消息进行内部处理。这意味着如果二维码内容是一个URL，它可能会被后续的“自动URL解析与存储”功能进一步解析和存储。
        4.  识别出的QR文本也会被存储。

6.  **自动URL解析与存储**
    *   **触发方式**: 用户发送任何包含URL（如 `http://...`, `https://...`, `b23.tv/...` 等）的消息。
    *   **功能**: 机器人会在后台静默地尝试解析消息中所有可识别的URL，追踪301/302重定向以获取最终的目标长链接。如果解析成功且原始链接与目标链接不同，该映射关系（原始短链接 -> 目标长链接）会被存储到数据库中，供后续快速查询或 `/resolveurls` 命令使用。此功能不需要用户执行任何特定命令。

## 四、使用提示

*   部分自动功能（如OCR、ASR）的开启/关闭由机器人管理员在后台配置 (`Env.cs` 文件中对应的 `Enable...` 选项)。
*   管理员指令通常需要在与机器人私聊或在机器人具有管理权限的群组中，由授权的管理员ID发送。
*   具体可用模型名称 (`设置模型` 指令) 取决于机器人管理员的配置。

希望这份指南能帮助您更好地使用 TelegramSearchBot！
