# TelegramSearchBot Orleans 重构进度

## Phase 0: 准备与基础架构

- **Task 0.1: Grain 接口定义**: 完成。
  - C# 接口已在 `TelegramSearchBot/Interfaces/` 目录下定义。
  - `Microsoft.Orleans.Core.Abstractions` NuGet 包已添加到主项目。

- **Task 0.2: Orleans 项目集成与 Silo/Client 配置**: 部分完成。
  - 相关的 Orleans NuGet 包 (v9.1.2) 已添加到 `TelegramSearchBot.csproj`。
  - 已尝试在 `TelegramSearchBot/AppBootstrap/GeneralBootstrap.cs` 中配置 Silo Host (`UseOrleans`, `UseLocalhostClustering`)。
  - **注意**: 关键的 Silo 配置（如 `ConfigureApplicationParts` 和 `UseSystemTextJson`）由于持续的编译错误（扩展方法找不到）已被暂时注释掉。需要用户在本地环境进一步排查。

- **Task 0.3: Stream ID 和消息模型定义**: 完成。
  - `OrleansStreamConstants.cs` (包含 Stream ID 和命名空间定义) 已创建在 `TelegramSearchBot/Model/`。
  - `StreamMessage<T>.cs` (通用消息包装类) 已创建在 `TelegramSearchBot/Model/`。

- **Task 0.4: 消息入口适配器与功能开关机制**: 部分完成。
  - `FeatureToggleService.cs` (用于管理功能开关) 已创建在 `TelegramSearchBot/Service/Common/`。
  - `HandleUpdateAsync` 方法在 `TelegramSearchBot/AppBootstrap/GeneralBootstrap.cs` 中已修改，以包含基于功能开关的路由逻辑。
  - **注意**: 将消息实际发布到 Orleans Streams 的代码由于持续的编译错误 (`Orleans.Streams` 命名空间找不到，导致 `GetStreamProvider` 扩展方法不可用) 已被暂时注释掉。

**总结**: Phase 0 的编码结构已初步搭建，但由于 Orleans 配置相关的编译问题，Silo Host 和消息流功能尚未完全启用和验证。建议优先解决这些编译和环境问题，然后才能继续 Phase 1 的 Grain 实现。
