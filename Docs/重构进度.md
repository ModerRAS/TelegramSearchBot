# TelegramSearchBot Orleans 重构进度

## Phase 0: 准备与基础架构

- **Task 0.1: Grain 接口定义**: 完成。
  - C# 接口已在 `TelegramSearchBot/Interfaces/` 目录下定义。
  - `Microsoft.Orleans.Core.Abstractions` NuGet 包已添加到主项目。

- **Task 0.2: Orleans 项目集成与 Silo/Client 配置**: 部分完成。
  - 相关的 Orleans NuGet 包 (v9.1.2) 已添加到 `TelegramSearchBot.csproj`。
  - 已尝试在 `TelegramSearchBot/AppBootstrap/GeneralBootstrap.cs` 中配置 Silo Host (`UseOrleans`, `UseLocalhostClustering`)。
  - **注意**: 根据最新反馈，新版 Orleans (7.0.0+) 不需要显式配置 `ConfigureApplicationParts` 来发现同一项目中的 Grains，Orleans 的默认机制会自动处理。因此，之前与此相关的编译问题已通过移除不必要的配置代码解决。Silo 将使用默认序列化器。

- **Task 0.3: Stream ID 和消息模型定义**: 完成。
  - `OrleansStreamConstants.cs` (包含 Stream ID 和命名空间定义) 已创建在 `TelegramSearchBot/Model/`。
  - `StreamMessage<T>.cs` (通用消息包装类) 已创建在 `TelegramSearchBot/Model/`。

- **Task 0.4: 消息入口适配器与功能开关机制**: 部分完成。
  - `FeatureToggleService.cs` (用于管理功能开关) 已创建在 `TelegramSearchBot/Service/Common/`。
  - `HandleUpdateAsync` 方法在 `TelegramSearchBot/AppBootstrap/GeneralBootstrap.cs` 中已修改，以包含基于功能开关的路由逻辑。
  - **注意**: 将消息实际发布到 Orleans Streams 的代码已取消注释，并且在 Stream 包正确安装的情况下，现在应该是可编译和功能正常的。

**总结**: Phase 0 的编码结构已按计划完成。Grain 接口、Stream 常量、消息模型、功能开关以及消息到 Stream 的发布逻辑均已实现。Orleans Silo Host 的基础配置已完成，并将依赖新版 Orleans 的默认机制进行 Grain 发现。
