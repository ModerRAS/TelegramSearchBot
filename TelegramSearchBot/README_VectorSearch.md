# 向量搜索功能说明

## 功能概述

本项目现在支持两种搜索方式：
1. **倒排索引搜索** (Lucene) - 基于关键词的精确匹配搜索
2. **向量搜索** - 基于语义相似度的智能搜索

## 使用方式

### 搜索命令

#### 倒排索引搜索（默认）
```
搜索 关键词
```
例如：`搜索 Python编程`

#### 向量搜索
```
向量搜索 查询内容
```
例如：`向量搜索 如何学习编程`

### 搜索结果界面

搜索结果会显示：
- 当前使用的搜索方式（倒排索引 / 向量搜索）
- 找到的结果数量和当前页面信息
- 消息链接列表

### 交互按钮

每个搜索结果都包含以下按钮：
- **下一页** - 查看更多搜索结果
- **切换到XXX搜索** - 在两种搜索方式之间切换
- **删除历史** - 删除搜索相关的历史消息

## 技术实现

### 架构设计

1. **SearchOption 模型扩展**
   - 添加了 `SearchType` 枚举字段
   - 支持 InvertedIndex 和 Vector 两种搜索类型

2. **CallbackDataService 服务**
   - 解耦了回调数据处理逻辑
   - 统一管理分页、删除历史、切换搜索方式等操作

3. **SearchService 改进**
   - 根据 SearchType 自动选择对应的搜索引擎
   - 支持群聊和私聊两种场景的向量搜索

4. **SearchView 视图增强**
   - 显示当前搜索方式
   - 支持搜索方式切换按钮

### 向量搜索流程

1. **群聊搜索**：直接在当前群组的向量库中搜索
2. **私聊搜索**：在用户所参与的所有群组中搜索，合并结果

### 依赖服务

- **VectorGenerationService** - 负责向量生成和搜索
- **QdrantClient** - 向量数据库客户端
- **IGeneralLLMService** - LLM服务用于生成文本向量

## 部署要求

确保以下服务正常运行：
1. Qdrant 向量数据库
2. LLM服务（用于生成向量）
3. Redis（用于缓存）

## 配置说明

在依赖注入容器中确保注册了以下服务：
- `IVectorGenerationService`
- `CallbackDataService`
- `QdrantClient`
- `IGeneralLLMService`

## 性能考虑

- 向量搜索的首次查询会计算总数，可能略慢
- 私聊搜索需要查询多个群组，响应时间取决于用户参与的群组数量
- 向量生成依赖LLM服务的性能

## 使用建议

- **精确搜索**：使用倒排索引搜索查找具体关键词
- **语义搜索**：使用向量搜索查找语义相关的内容
- **快速切换**：可以在搜索结果中直接切换搜索方式进行对比 